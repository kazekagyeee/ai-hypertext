package kazekagyee.hyperlink

import org.springframework.stereotype.Service

@Service
class KeywordExtractorService {

    private val amountOfKeywords = 10
    private val stopWords = setOf(
        // Местоимения
        "я", "ты", "он", "она", "оно", "мы", "вы", "они",
        "меня", "тебя", "его", "её", "нас", "вас", "их",
        "мне", "тебе", "ему", "ей", "нам", "вам", "им",
        "мной", "тобой", "им", "ей", "нами", "вами", "ими",
        "мой", "твой", "его", "её", "наш", "ваш", "их",
        "моя", "твоя", "наша", "ваша",
        "моё", "твоё", "наше", "ваше",
        "мои", "твои", "наши", "ваши",
        "себя", "себе", "собой",

        // Предлоги
        "в", "на", "с", "со", "из", "от", "до", "по", "к", "ко",
        "у", "о", "об", "обо", "за", "над", "под", "перед", "при",
        "про", "через", "сквозь", "между", "среди", "вокруг",
        "возле", "около", "близ", "вдоль", "поперёк", "против",
        "ради", "благодаря", "вопреки", "вследствие", "для",

        // Союзы
        "и", "а", "но", "или", "либо", "ни", "да", "что", "чтобы",
        "как", "когда", "где", "куда", "откуда", "почему", "зачем",
        "сколько", "столько", "потому", "поэтому", "также",
        "тоже", "причем", "причём", "однако", "тем", "чем",

        // Частицы
        "ли", "бы", "б", "же", "ж", "ведь", "вот", "мол", "дескать",
        "де", "не", "ни", "только", "лишь", "исключительно",
        "почти", "едва", "точно", "ровно", "прямо", "просто",
        "именно", "как", "раз", "всего", "всего-навсего",

        // Наречия (общие)
        "очень", "совсем", "полностью", "абсолютно", "совершенно",
        "весьма", "крайне", "чрезвычайно", "сильно", "слабо",
        "много", "мало", "немного", "чуть", "чуть-чуть",
        "быстро", "медленно", "хорошо", "плохо", "отлично",
        "здесь", "там", "тут", "везде", "всюду", "нигде",
        "всегда", "никогда", "иногда", "часто", "редко",
        "сейчас", "теперь", "потом", "после", "раньше",
        "очень", "слишком", "довольно", "вполне", "почти",

        // Глаголы-связки и вспомогательные
        "есть", "быть", "являться", "является", "являются",
        "стать", "становиться", "оказаться", "казаться",
        "мочь", "смочь", "уметь", "суметь", "хотеть", "захотеть",
        "должен", "должна", "должно", "должны", "надо", "нужно",
        "можно", "нельзя", "стоит", "следует", "приходится",

        // Числительные и количественные
        "один", "два", "три", "четыре", "пять", "шесть", "семь",
        "восемь", "девять", "десять", "сколько", "столько",
        "много", "немного", "мало", "немало", "несколько",
        "первый", "второй", "третий", "последний", "следующий",

        // Вопросительные слова
        "кто", "что", "какой", "какая", "какое", "какие",
        "чей", "чья", "чьё", "чьи", "который", "которая",
        "которое", "которые", "как", "где", "куда", "откуда",
        "когда", "почему", "зачем", "сколько",

        // Указательные слова
        "этот", "эта", "это", "эти", "тот", "та", "то", "те",
        "такой", "такая", "такое", "такие", "таков", "такова",
        "таково", "таковы", "сей", "сия", "сие", "сии",

        // Другие служебные слова
        "вот", "вон", "тут", "там", "здесь", "везде", "всюду",
        "тогда", "теперь", "сейчас", "потом", "после",
        "опять", "снова", "еще", "ещё", "уже", "только",
        "лишь", "именно", "почти", "ровно", "точно",
        "прямо", "просто", "особенно", "главным", "образом",

        // Временные указатели
        "сегодня", "завтра", "вчера", "утром", "днём", "вечером",
        "ночью", "неделю", "месяц", "год", "года", "лет",

        // Пространственные указатели
        "справа", "слева", "сверху", "снизу", "впереди", "сзади",
        "внутри", "снаружи", "далеко", "близко", "высоко", "низко",

        // Прочие частотные слова
        "вообще", "обычно", "часто", "редко", "иногда", "никогда",
        "всегда", "почти", "совсем", "absolutely", "полностью",
        "частично", "основной", "главный", "важный", "нужный",
        "возможный", "невозможный", "правильный", "неправильный",
        "хороший", "плохой", "большой", "маленький", "новый", "старый"
    )

    fun extractKeywords(text: String): List<String> {
        val words = text.split(Regex("[^А-Яа-яЁёA-Za-z]+"))
            .asSequence()
            .filter { it.length >= 3 && it.isNotBlank() }
            .map { it.lowercase() }
            .filterNot { stopWords.contains(it) }
            .distinct()
            .take(amountOfKeywords)
            .toList()

        println("Found words: $words")
        return words
    }

    fun highlightKeywords(text: String, keywords: List<String>): String {
        var result = text
        for (word in keywords) {
            val regex = Regex("(?<!\\S)$word(?!\\S)", RegexOption.IGNORE_CASE)
            result = regex.replace(result) {
                """<span class="keyword" data-word="${it.value}">${it.value}</span>"""
            }
            //result.replace(word, """<span class="keyword" data-word="$word">${word}</span>""")
        }
        return result
    }
}